<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <title>位置観測 経路記録マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <meta name="description" content="リアルタイム位置観測 経路記録ウェブアプリ">
  <meta name="theme-color" content="#1976d2">

  <!-- ===== ファビコン（1024x1024 PNG固定） ===== -->
  <link rel="icon" type="image/png" sizes="1024x1024" href="icon/map.png">
  <link rel="apple-touch-icon" sizes="1024x1024" href="icon/map.png">
  <link rel="shortcut icon" href="icon/map.png">

  <!-- ===== Leaflet CSS ===== -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" as="style"
    onload="this.rel='stylesheet'">
  <link rel="preload"
    href="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.css" as="style"
    onload="this.rel='stylesheet'">

  <!-- ===== 自作CSS ===== -->
  <link rel="stylesheet" href="map.css">

  <!-- ===== Leaflet JS ===== -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"
    defer></script>

  <!-- ===== 自作JS ===== -->
  <script src="map.js" defer></script>
</head>

<body>
  <div id="app">
    <div id="map"></div>
    <div class="panel">
      <h2>📍 位置観測 経路記録マップ</h2>
      <button id="togglePreview" style="width: 100px;">カメラ撮影</button>
      <div style="display: flex; gap: 8px; margin-top: 8px;">
        <button id="navModeBtn" class="secondary">ナビ開始(車のみ)</button>
        <button id="cancelNavBtn" class="secondary">ナビ取り消し</button>
      </div>
      <button id="darkModeToggle" class="secondary" style="margin-top:10px;">ダークモード</button>
      <div class="row medium bold">所要時間:<span id="eta">---</span></div>
      <div class="row medium address-row bold">
        <span style="color: blue;">
          現在地住所:
          <span id="currentAddress">---</span>
        </span>
        <span style="color: red;">
          目的地住所:
          <span id="destAddress">---</span>
        </span>
      </div>

      <div class="row small">最終更新:<time id="lastAge">---</time></div>
      <div class="info-grid">
        <div class="stat">緯度: <div id="lat">---</div>
        </div>
        <div class="stat">経度: <div id="lng">---</div>
        </div>
        <div class="stat">精度: <div id="acc">---</div>
        </div>
        <div class="stat">高度: <div id="alt">---</div>
        </div>
        <div class="stat">速度: <div id="speed">---</div>
        </div>
        <div class="stat">方角: <div id="heading">---</div>
        </div>
      </div>

      <div class="controls">
        <button id="stopBtn" class="danger" onclick="btn_toggle()">観測停止</button>
        <button id="restartBtn" class="btn-pointer-none" onclick="btn_toggle()">再開</button>
        <button id="centerToggle" class="secondary">自動追尾: ON</button>
        <button id="exportJsonBtn" class="warning">JSON保存</button>
        <button style="background-color: green;"
          onclick="if (confirm('再読み込みすると一部のデータ（ナビ中の情報など）が失われます。\nよろしいですか？')) { window.location.href = window.location.href; }">
          ページ<br>再読み込み
        </button>
        <button id="clearBtn" class="secondary">ログ<br>経路クリア</button>
      </div>

      <div class="row item-center medium">
        <div>総距離: <data id="totalDist">0 m</data></div>
        <div>平均速度: <data id="avgSpeed">0 km/h</data></div>
      </div>

      <label id="logToggleLabel">
        過去の位置情報ログ
        <button id="logToggleBtn" class="secondary">▼</button>
      </label>
      <div id="log-container">
        <div id="log"></div>
      </div>
      <div class="small">※位置の取得は1秒以上間隔を空けています。</div>
    </div>

    <div id="camera_area">
      <video id="preview" autoplay playsinline muted></video>
      <div id="controls">
        <button id="photoBtn" class="btns">📸</button>
        <button id="videoBtn" class="btns">●</button>
        <button id="videoreturn" class="btns">戻る</button>
      </div>
    </div>

  </div>

</body>

</html>